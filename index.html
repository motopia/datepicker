<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
    <title>超简单日期控件实现</title>
    <meta name="renderer" content="webkit"><!-- 360采用急速模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="region_data.js"></script>
    <style>
    	.datepicker{
    		display: inline-block;
    		width:506px;
    	}
	    ul{
	    	list-style: none;
	    	margin: 0;
	    	padding: 0;
	    }
	    li{
	    	width: 505px;
	    	padding: 0;
	    }
		li label{
			display: inline-block;
			width: 70px;
			height: 30px;
			line-height: 30px;
			float: left;
			text-align: center;
			border: 1px solid #B8C163;
		}	
		.currentmonth{
			display: inline-block;
			width: 20px;
		}
		.control{
			text-align: center;
			padding: 10px;
		}
		.control:before,.control:after{
			overflow:hidden;
		}	
		.week:before,.week:after{
			height: 0;
			overflow:hidden;
		}	
    </style>
</head>
<body>
	<div class="datepicker">
		<div class="control">
			<button class="lastyear"><<</button>
			<button class="lastmonth"><</button>
			<label class="currentyear">2015</label>
			<label class="currentmonth">10</label>
			<button class="nextmonth">></button>
			<button class="nextyear">>></button>
		</div>
		<div class="week">
			<ul>
				<li>
					<label>日</label>
					<label>一</label>
					<label>二</label>
					<label>三</label>
					<label>四</label>
					<label>五</label>
					<label>六</label>
				</li>
				<li class="dinamicDom">
				</li>
			</ul>
		</div>
	</div>
	<script>
		var currentYear = new Date().getFullYear(); //四位数年份
		var currentMonth = new Date().getMonth()+1; //0-11 加一
		setCurrentYearAndMonth();
		//上一年，起点是1900
		document.querySelector('.lastyear').onclick = function(){
			currentYear = currentYear-1 <1900 ? currentYear: currentYear-1; 
			setCurrentYearAndMonth();
		}
		//上个月 
		document.querySelector('.lastmonth').onclick = function(){
			if(currentMonth==1 && currentYear==1900) return;
			currentYear = currentMonth-1 < 1 ? currentYear - 1:currentYear; 
			currentMonth = currentMonth-1 < 1 ? 12: currentMonth-1; 
			setCurrentYearAndMonth();
		}
		//下一年
		document.querySelector('.nextyear').onclick = function(){
			currentYear = currentYear + 1; 
			setCurrentYearAndMonth();
		}
		//下个月
		document.querySelector('.nextmonth').onclick = function(){
			currentYear = currentMonth + 1 >12 ? currentYear + 1:currentYear; 
			currentMonth = currentMonth + 1 >12 ? 1: currentMonth+1;
			setCurrentYearAndMonth();
		}
		//设置当前年月日
		function setCurrentYearAndMonth(){
			document.querySelector('.currentyear').innerText = currentYear;
			document.querySelector('.currentmonth').innerText =currentMonth;
			//是否当天
			var is_currentDay = new Date().getFullYear()==currentYear && new Date().getMonth()+1==currentMonth;
			//是否闰年
			var is_leapYear = currentYear%100==0 && currentYear%400==0;
			//是否闰月
			var is_leapMonth = currentMonth ==2;
			//计算当前天数
			var daysOfCurrentMonth =is_leapYear && is_leapMonth ?29:is_leapMonth?28:[1,3,5,7,8,10,12].indexOf(currentMonth)!=-1?31:30;
			//布局日期
			var currentDom = "";
			for (var i = 1; i <= daysOfCurrentMonth; i++) {
				var d = i;
				var m = currentMonth==1 || currentMonth==2?currentMonth+12:currentMonth;
				var y = currentMonth==1 || currentMonth==2? currentYear-1:currentYear;
				var W = Math.round((d+2*m+3*(m+1)/5+y+y/4-y/100+y/400)%7); //基姆拉尔森计算公式计算日期
				if(i==1){
					for (var j = W; j >= 1; j--) {
						currentDom += "<label>&nbsp;</label>"
					};
					currentDom += "<label style='"+(is_currentDay && i==new Date().getDate()?"color:red;background-color:#ccf;":"")+"'>"+i+"</label>";
				}else if(i==daysOfCurrentMonth){
					currentDom += "<label style='"+(is_currentDay && i==new Date().getDate()?"color:red;background-color:#ccf;":"")+"'>"+i+"</label>";
					for (var k = 6-W; k >= 1; k--) {
						currentDom += "<label>&nbsp;</label>"
					};
				}else{
					currentDom += "<label style='"+(is_currentDay && i==new Date().getDate()?"color:red;background-color:#ccf;":"")+"'>"+i+"</label>";
				}
			};
			document.querySelector('.dinamicDom').innerHTML = currentDom;
		}
	</script>
</body>
</html>